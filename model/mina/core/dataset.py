"""
Dataset configuration utilities.
"""

from pathlib import Path

from mina.core.constants import DISEASE_CLASSES, NUM_CLASSES


def create_data_yaml(data_dir: Path) -> Path:
    """
    Create the data.yaml configuration file for training.

    Args:
        data_dir: Directory containing images/ and labels/ subdirectories

    Returns:
        Path to the created data.yaml file
    """
    names_yaml = "\n".join(f"  {i}: {cls}" for i, cls in enumerate(DISEASE_CLASSES))

    yaml_content = f"""# Fish Disease Detection Dataset
# Auto-generated by mina

path: {data_dir.absolute()}
train: images/train
val: images/val

# Class names
names:
{names_yaml}

# Number of classes
nc: {NUM_CLASSES}
"""

    yaml_path = data_dir / "data.yaml"
    yaml_path.write_text(yaml_content)
    return yaml_path


def create_test_yaml(test_dir: Path) -> Path:
    """
    Create a data.yaml for test set evaluation.

    Args:
        test_dir: Directory containing test images/ and labels/

    Returns:
        Path to the created yaml file
    """
    names_yaml = "\n".join(f"  {i}: {cls}" for i, cls in enumerate(DISEASE_CLASSES))

    yaml_content = f"""# Fish Disease Detection - Test Set Evaluation
path: {test_dir.absolute()}
train: images  # Not used, but required by YOLO
val: images    # Point to test images for evaluation

names:
{names_yaml}

nc: {NUM_CLASSES}
"""

    yaml_path = test_dir / "test_data.yaml"
    yaml_path.write_text(yaml_content)
    return yaml_path
